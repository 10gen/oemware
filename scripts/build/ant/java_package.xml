    <!-- 
    (C) Copyright 2007, Deft Labs.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Lesser General Public License as published 
    by the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU Lesser General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

    Version: $Id$
    -->

    <!-- ******************************************************************* -->
    <!-- Build an app.                                                       --> 
    <!-- ******************************************************************* -->

    <target name="build.java.app">
        <mkdir dir="${dir.build}/dist"/>
        <tar tarfile="${dir.build}/dist/${build.app.name}.tar" basedir="${dir.build}/modules/${build.app.name}" compression="gzip"/>
        <move file="${dir.build}/dist/${build.app.name}.tar" tofile="${dir.build}/dist/${build.app.name}.tar.gz"/>
    </target>

    <!-- ******************************************************************* -->
    <!-- Package the web files.                                              --> 
    <!-- ******************************************************************* -->
    
    <target name="package.web"> 
        <mkdir dir="${dir.build}/modules/${package.app.name}/${package.web.dir}/${package.web.context}/WEB-INF/src"/> 
        <mkdir dir="${dir.build}/modules/${package.app.name}/${package.web.dir}/${package.web.context}/WEB-INF/classes"/> 
        <mkdir dir="${dir.build}/modules/${package.app.name}/${package.web.dir}/${package.web.context}/WEB-INF/lib"/> 
        <copy file="${package.dir.conf}/web.xml" tofile="${dir.build}/modules/${package.app.name}/${package.web.dir}/${package.web.context}/WEB-INF/web.xml" filtering="true"/>
    </target>

    <!-- ******************************************************************* -->
    <!-- Package the java libs.                                              --> 
    <!-- ******************************************************************* -->
    
    <target name="package.java.lib"> 
        <mkdir dir="${dir.build}/lib/java"/> 
        <mkdir dir="${dir.build}/modules/lib/java"/> 

        <copy todir="${dir.build}/lib/java" filtering="false"><fileset dir="lib/java/"/></copy>
        <copy todir="${dir.build}/modules/lib/java" filtering="false"><fileset dir="lib/java/"/></copy>

        <tstamp><format property="build.time" pattern="yyyy-MM-dd H:mm z"/></tstamp>
<echo append="false" file="${dir.build}/lib/java//VERSION">version: ${build_tag} 
time: ${build.time}</echo>

    </target>

    <!-- ******************************************************************* -->
    <!-- Package the java libs.                                              -->
    <!-- ******************************************************************* -->
    
    <target name="build.java.lib">
        <antcall target="package.java.lib">
            <param name="lib.java.name" value="${lib.java.name}"/>
        </antcall>

        <mkdir dir="${dir.build}/dist"/>
        <tar tarfile="${dir.build}/dist/${lib.java.name}.tar" basedir="${dir.build}/lib/java/${lib.java.name}" compression="gzip"/>
        <move file="${dir.build}/dist/${lib.java.name}.tar" tofile="${dir.build}/dist/${lib.java.name}.tar.gz"/>
    </target>

    <!-- ******************************************************************* -->
    <!-- Package an app. The app.name property must be set.                  -->
    <!-- ******************************************************************* -->
    
    <target name="package.java.app">
        <mkdir dir="${dir.build}/modules/${package.app.name}/lib/java"/> 
        <mkdir dir="${dir.build}/modules/${package.app.name}/conf"/> 
        <mkdir dir="${dir.build}/modules/${package.app.name}/bin"/> 

        <tstamp><format property="build.time" pattern="yyyy-MM-dd H:mm z"/></tstamp>
<echo append="false" file="${dir.build}/modules//${package.app.name}/VERSION">version: ${build_tag} 
time: ${build.time}</echo>

        <copy todir="${dir.build}/modules/${package.app.name}/conf/" filtering="true">
            <fileset dir="${package.dir.conf}">
                <exclude name="**/*web.xml"/>
            </fileset>
        </copy>

        <copy todir="${dir.build}/modules/${package.app.name}/conf/" filtering="true"><fileset dir="conf/modules/common"/></copy>

        <copy file="scripts/service/module/service_java.sh" tofile="${dir.build}/modules/${package.app.name}/bin/service_java.sh" filtering="true"/>
        <copy file="scripts/service/module/default.sh" tofile="${dir.build}/modules/${package.app.name}/bin/default.sh" filtering="true"/>
        <copy file="${package.service.script}.sh" tofile="${dir.build}/modules/${package.app.name}/${package.app.name}.sh" filtering="true"/>
        <chmod perm="ug+rx" file="${dir.build}/modules/${package.app.name}/${package.app.name}.sh"/>

        <jar destfile="${dir.build}/modules/${package.app.name}/lib/java/${package.app.name}.jar" basedir="${dir.build}/java/classes"/>
    </target>

    <!-- ******************************************************************* -->
